- **Listeners** - Similar to Netcat or multi/handler for receiving back stagers.
- **Stagers** - Similar to a payload with further functionality for deploying agents.
- **Agents** - Used to interact with agents on the device to perform "tasks". 
- **Modules** - Modules that can be used as tools or exploits.
- **Credentials** - Reports all credentials found when using modules.
- **Reporting** - A report of every module and command run on each agent.

<u>Listeners</u>
The first menu you will see is a listeners menu. This menu will allow you to create and list what listeners you have available. Listeners will listen on a specific port similar to Netcat or multi handler.

![[Pasted image 20240216082219.png]]


<u>Stagers</u>
Stagers will be the second point to getting an agent to connect back to your C2 server. This menu similar to the listener menu will allow you to create and list what stagers you have available. Stagers will send off an agent similar to a payload.

![[Pasted image 20240216082242.png]]


<u>Agents</u>
Agents will be where you do a majority of interaction in *Starkiller*. This menu will allow you to see an overview of all agents and interact with specific agents. Agents are like shells back to the device, you can send shell commands and modules from agents.

![[Pasted image 20240216082313.png]]


<u>Modules</u>
The Modules menu will give you an overview of all modules available and allow you to search for a particular module. Modules are specific tools and exploits that can be used with agents like enumeration scripts, privilege escalation methods, and exploits.
![[Pasted image 20240216082322.png]]


<u>Credentials</u>
The Credentials menu is a very useful menu in *Starkiller* that will save any enumerated credentials found from a device or module. It can either save hashes or plaintext passes; you can also manually add any credentials it does not auto collect.

![[Pasted image 20240216082400.png]]


<u>Reporting</u>
The Reporting menu is another useful menu that allows you to see shell commands or modules that you have run in the past and report them to this menu, making it great for looking back at your work.

---
# Listeners
ï»¿Listeners are used in Empire similar to how they are used in any other normal listener like Netcat and multi/handler. These listeners can have some very useful functionality that can help with agent management as well as *concealing your traffic / evading detections*

- `http` - This is the standard listener that utilizes HTTP to listen on a specific port.
- `http_com` - Uses the standard HTTP listener with an IE COM object.
- `http_foreign` - Used to point to a different Empire server.
- `http_hop` - Used for creating an external redirector using PHP.
- `http_mapi` - Uses the standard HTTP listener with a MAPI COM object.

The next five commands all use variations of built out services or have unique features that make them different from other listeners.
- `meterpreter` -  Used to listen for Metasploit stagers.
- `onedrive` - Utilizes OneDrive as the listening platform.
- `redirector` - Used for creating pivots in a network.
- `dbx` - Utilizes Dropbox as the listening platform.
- `http_malleable` - Used alongside the malleable C2 profiles from BC-Security.

There is also the ability to create custom malleable c2 listeners that act as beacons to emulate certain threats or APTs!


#### Creating a Listener
1. Navigate to the listeners tab and select 'CREATE LISTENER'
2. Select your listener type, for the demo, we'll use an HTTP listener.
3. Configure your listener, the only two options you will need to change are the host IP and the host port.

The menu for creating a listener gives us many options to choose from. These option fields will change from listener to listener. Below is an outline of each field present for the HTTP listener and how they can be used and adjusted.

- Name - Specify what name the listener shows up as in the listener menu.
- Host - IP to connect back to.
- Port - Port to listen on.
- BindIP - IP to bind to (typically localhost / 0.0.0.0)

These options can be used for specifying how the listener operates and runs when started and while running.
- DefaultDelay
- DefaultJitter
- DefaultLostLimit

The following options can be useful for bypassing detection techniques and creating more complex listeners.
- DefaultProfile - Will allow you to specify the profile used or User-Agent.
- Headers - Since this is an HTTP listener it will specify HTTP headers.
- Launcher - What launcher to use for the listener this will be prefixed on the stager.

---
# Stager
Empire has multiple parts to each stage to help identify each one. First is the platform this can include multi, OSx, and Windows. Second the stager type itself / launcher.

Below are 3 stagers that are general purpose and can be used as your basic stagers. multi/launcher is the most all-purpose stager and can be used for a variety of scenarios, this is the stager we will use for demo purposes in this room.
- **multi/launcher** - A fairly universal stager that can be used for a variety of devices.
- **windows/launcher_bat** - Windows Batch file
- **multi/bash** - Basic Bash Stager

You can also use stagers for more specific applications similar to the listeners. These can be anything from macro code to ducky code for USB attacks.
- **windows/ducky** - Ducky script for the USB Rubber Ducky for physical USB attacks.
- **windows/hta** - HTA server an HTML application protocol that can be used to evade AV.
- **osx/applescript** - Stager in AppleScript: Apple's own programming language.
- **osx/teensy** - Similar to the rubber ducky is a small form factor micro-controller for physical attacks.


- Listener - Select which listener to use from a list of created listeners on the Empire server.
- Base64 - Enable or disable stager encoding with base64.
- Language - Language used to create the stager: bash, PowerShell, Python, etc.
- SafeChecks - Enable or disable checks for the stager.

---
# Agents
Different to a normal shell, with any C2 server once you have an agent connected back to the C2 server you can use any modules and* not trip AV or other detections because they are run remotely*. All agents have the same functionality and modules available the stager and listener only determine how the agent is sent to the device and how it connects back.

Agents are color-coded and use icons to help distinguish Agent status. Below is an outline of the color and icon scheme
<mark style="background: #FF5582A6;">Red</mark> - User is no longer responding
Black - User is responding normally 
User Icon - Normal user account
User Icon w/ Gear - System user account

---
# Modules
Modules are used in Empire as a way of packaging tools and exploits to be easily used with agents. These modules can be useful for easily compiling exploits, using tools, and bypassing anti-virus.

We can take a look at a few useful ones for enumeration and privilege escalation outlined below:
- Seatbelt
- Mimikatz 
- WinPEAS

Empire sorts the modules by the language used: PowerShell, python, external, and exfiltration as well as categories for modules you can find the categories below.
- code execution
- collection
- credentials
- exfiltration
- exploitation
- lateral movement
- management
- persistence 
- privesc
- recon
- situational awareness 
- trollsploit

Empire categorizes modules based on MITRE ATT&CK and provides the techniques used for each module in the ATT&CK naming convention such as [T1552](https://attack.mitre.org/techniques/T1552/004/)

Using modules is pretty straightforward, you can open a user interaction menu and find the module you want to use. Once you have the module you want to use some require that you enter some details like a command to run, listener, etc. and others you can just run straight out of the box

Below you can see us running the Seatbelt module, for the module, it does not require any configuration you simply select the module then run it. If you want more control over modules you can select the Optional Fields drop-down and have other options you can configure for example specifying a command in Seatbelt to run.![[Pasted image 20240216085645.png]]


---
# Plugins
Plugins are an extension of the base set of modules that Empire comes with.  You can easily download and use community-made plugins to extend the use of Empire.

To use a plugin, transfer a plugin.py file to the /plugins directory of Empire. As an example of how to use plugins, we will be using the socks server plugin made by BC-Security, you can download it [here](https://github.com/BC-SECURITY/SocksProxyServer-Plugin).

###### Using Plugins
Transfer or clone the plugin that you want to use into the plugins directory for Empire.
![[Pasted image 20240216090210.png]]

After Empire version 3.4.0, Empire automatically loads plugins into the server. If the plugin is not already running you can use the plugin command to load the plugin for use. 

Syntax: plugin [plugin name]
![[Pasted image 20240216090315.png]]


You can run plugins using the *start* and *stop* commands. Depending on the plugin the flags / parameters can change for each.

Syntax: start [plugin name]
Syntax: stop [plugin name]
![[Pasted image 20240216090219.png]]

Usage of plugins works differently for each plugin. The socks server plugin uses a start and stop command along with the name of the plugin to start up a new proxy server similar to putting a proxy directly onto the host, but plugins are directly contained within Empire.