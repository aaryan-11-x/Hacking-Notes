# New Scan
Here we have options for a basic Host Discovery scan to identify live hosts/open ports or a variety of scan types such as the *Basic Network Scan, Advanced Scan, Malware Scan, Web Application Tests*, as well as *scans targeted at specific CVEs* and audit & compliance standards. A description of each scan type can be found here.
![[Pasted image 20231106103741.png]]


## Basic Network Scan
![[Pasted image 20231106103801.png]]

### Discovery
In the **Discovery** section, under *Host Discovery*, we're presented with the option to enable scanning for fragile devices. Scanning devices such as *network printers* often result in them printing out reams of paper with garbage text, leaving the devices unusable. We can leave this setting disabled:![[Pasted image 20231106103901.png]]

In **Port Scanning**, we can choose whether to scan common ports, all ports, or a self-defined range
![[Pasted image 20231106103927.png]]

Within the **Service Discovery** subsection, the`Probe all ports to find services` option is selected by default. It's possible that a poorly designed application or service could crash as a result of this probing, but most applications should be robust enough to handle this. Searching for `SSL/TLS services` is also enabled by default on a custom scan.


### Assessment
Under the **Assessment** category, web application scanning can also be enabled if required, and a custom user agent and various other web application scanning options can be specified (e.g., a URL for [[RFI]] testing):

![[Pasted image 20231106104553.png]]

Nessus can perform a brute-force attack with the provided username and password lists![[Pasted image 20231106104628.png]]

User enumeration can also be performed using various techniques, such as **RID Brute Forcing**
If we opt to perform RID Brute Forcing, we can set the starting and ending UIDs for both domain and local user accounts:
![[Pasted image 20231106104711.png]]


### Advanced
On the <mark style="background: #BBFABBA6;">Advanced</mark> tab, safe checks are enabled by default. This prevents Nessus from running checks that may negatively impact the target device or network. We can also choose to slow or `throttle` the scan if Nessus detects any network congestion.
![[Pasted image 20231106105011.png]]

---
# Advanced Settings
https://academy.hackthebox.com/module/108/section/1232

---
# Scanning with Credentials
- For **Host**
![[Pasted image 20231107211901.png]]

- For **Database**
![[Pasted image 20231107211934.png]]

## Credentialed Patch Audit
The difference between this and the Basic Network Scan template with provided credentials is that the Credentialed Patch Audit scan *only uses local security checks and will not do a regular vulnerability check* from an external perspective. The **Credentialed Patch Audit** template will not only scan for missing operating system patches but also for outdated applications, which may be vulnerable to *privilege escalation attacks*.

![[Pasted image 20240613114330.png]]


---
# Download Report from CLI
```sh
aaryan11x@htb[/htb]$ ./nessus_downloader.rb 

Nessus 6 Report Downloader 1.0

Enter the Nessus Server IP: 127.0.0.1
Enter the Nessus Server Port [8834]: 8834
Enter your Nessus Username: admin
Enter your Nessus Password (will not echo): 

Getting report list...
Scan ID Name                                               Last Modified                  Status         
------- ----                                               -------------                  ------         
1     Windows_basic                                Aug 22, 2020 22:07 +00:00      completed      
         
Enter the report(s) your want to download (comma separate list) or 'all': 1

Choose File Type(s) to Download: 
[0] Nessus (No chapter selection)
[1] HTML
[2] PDF
[3] CSV (No chapter selection)
[4] DB (No chapter selection)
Enter the file type(s) you want to download (comma separate list) or 'all': 3

Path to save reports to (without trailing slash): /assessment_data/inlanefreight/scans/nessus

Downloading report(s). Please wait...

[+] Exporting scan report, scan id: 1, type: csv
[+] Checking export status...
[+] Report ready for download...
[+] Downloading report to: /assessment_data/inlanefreight/scans/nessus/inlanefreight_basic_5y3hxp.csv

Report Download Completed!
```

---
# Mitigating Issues
- Some firewalls will cause us to receive scan results showing either all ports open or no ports open. If this happens, a quick fix is often to configure an Advanced Scan and disable the `Ping the remote host` option.
- In sensitive networks, we can use rate-limiting to minimize impact. For example, we can adjust `Performance Options` and modify `Max Concurrent Checks Per Host` if the target host is often under heavy load, such as a widely used web application.
- Unless specifically requested, we should *never perform Denial of Service checks*. We can ensure that these types of plugins are not used by always enabling the `safe checks` option when performing scans to avoid any network plugins that can have a negative impact on a target.

---
# Determine Network Impact
It is also essential to keep in mind the potential impact of vulnerability scanning on a network, especially on low bandwidth or congested links. This can be measured using `vnstat`
```sh
sudo apt install vnstat
```

```sh
# eth0 network before running Nessus scan
sudo vnstat -l -i eth0

Monitoring eth0...    (press CTRL-C to stop)

   rx:       332 bit/s     0 p/s          tx:       332 bit/s     0 p/s

   rx:         0 bit/s     0 p/s          tx:         0 bit/s     0 p/s
   rx:         0 bit/s     0 p/s          tx:         0 bit/s     0 p/s^C

 eth0  /  traffic statistics

                           rx         |       tx
--------------------------------------+------------------
  bytes                        572 B  |           392 B
--------------------------------------+------------------
          max              480 bit/s  |       332 bit/s
      average              114 bit/s  |        78 bit/s
          min                0 bit/s  |         0 bit/s
--------------------------------------+------------------
  packets                          8  |               5
--------------------------------------+------------------
          max                  1 p/s  |           0 p/s
      average                  0 p/s  |           0 p/s
          min                  0 p/s  |           0 p/s
--------------------------------------+------------------
  time                    40 seconds
```
```sh
# eth0 after running Nessus scan
Monitoring eth0...    (press CTRL-C to stop)

   rx:   307.92 kbit/s   641 p/s          tx:   380.41 kbit/s   767 p/s^C

 eth0  /  traffic statistics

                           rx         |       tx
--------------------------------------+------------------
  bytes                     1.04 MiB  |        1.34 MiB
--------------------------------------+------------------
          max          414.81 kbit/s  |   480.59 kbit/s
      average          230.57 kbit/s  |   296.72 kbit/s
          min                0 bit/s  |         0 bit/s
--------------------------------------+------------------
  packets                      18252  |           22733
--------------------------------------+------------------
          max                864 p/s  |         969 p/s
      average                480 p/s  |         598 p/s
          min                  0 p/s  |           0 p/s
--------------------------------------+------------------
  time                    38 seconds


real  0m38.588s
user  0m0.002s
sys 0m0.016s
```
